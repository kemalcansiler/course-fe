<div class="course-detail-container">
  <!-- Background Image -->
  <div class="background-image"></div>

  @if (loading()) {
    <app-course-detail-skeleton></app-course-detail-skeleton>
  } @else if (course()) {
    <div class="course-detail-layout">
      <!-- Main Content -->
      <div class="main-content">
        <!-- Breadcrumbs -->
        <nav class="breadcrumbs">
          <span>Programming</span>
          <mat-icon>chevron_right</mat-icon>
          <span>Web Development</span>
          <mat-icon>chevron_right</mat-icon>
          <span>JavaScript</span>
        </nav>

        <!-- Course Header -->
        <div class="course-header">
          <h1 class="course-title">{{ course()!.title }}</h1>
          <p class="course-subtitle">{{ course()!.shortDescription }}</p>

          <div class="course-badges">
            @if (course()!.isFeatured) {
              <mat-chip class="badge-chip">Featured</mat-chip>
            }
          </div>

          <div class="course-meta">
            @if (course()!.instructor; as instructor) {
              <div class="instructor-info">
                <span
                  >Created by
                  <strong
                    >{{ instructor.firstName }} {{ instructor.lastName }}</strong
                  ></span
                >
              </div>
            }
            <div class="last-updated">
              <span>Created {{ course()!.createdAt | date }}</span>
            </div>
            <div class="language-info">
              <span>{{ course()!.language }}</span>
            </div>
          </div>

          <div class="rating-section">
            <div class="rating">
              <span class="rating-value">{{ course()!.rating | number: '1.1-1' }}</span>
              <div class="stars">
                @for (star of getStars(course()!.rating); track $index) {
                  <mat-icon class="star-icon">{{ star }}</mat-icon>
                }
              </div>
              <span class="rating-count">({{ course()!.reviewCount | number }} ratings)</span>
            </div>
            <div class="students-count">
              <mat-icon>people</mat-icon>
              <span>{{ course()!.enrollmentCount | number }} learners</span>
            </div>
          </div>
        </div>

        <!-- Course Description -->
        <div class="course-description">
          <h2>About this course</h2>
          <p>{{ course()!.description }}</p>
        </div>

        <!-- Course Content -->
        @if (course()!.curriculum && course()!.curriculum.length > 0) {
          <div class="course-content">
            <div class="content-header">
              <h2>Course content</h2>
              <div class="content-summary">
                <span
                  >{{ course()!.sections || 0 }} sections • {{ course()!.lectures || 0 }} lectures •
                  {{ course()!.duration }} total length</span
                >
                <button mat-button (click)="expandAllSections()">Expand all sections</button>
              </div>
            </div>

            <mat-accordion class="curriculum-accordion">
              @for (section of course()!.curriculum; track section.id) {
                <mat-expansion-panel [expanded]="section.isExpanded" class="curriculum-section">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <div class="section-title">
                        <span>{{ section.title }}</span>
                        <span class="section-meta"
                          >{{ section.lectures }} lectures • {{ section.duration }}</span
                        >
                      </div>
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <div class="section-lessons">
                    @for (lesson of section.lessons; track lesson.id) {
                      <div class="lesson-item">
                        <mat-icon class="lesson-icon">{{ getLessonIcon(lesson.type) }}</mat-icon>
                        <div class="lesson-content">
                          <span class="lesson-title">{{ lesson.title }}</span>
                          @if (lesson.isPreview) {
                            <span class="preview-badge">Preview</span>
                          }
                        </div>
                        <span class="lesson-duration">{{ lesson.duration }}</span>
                      </div>
                    }
                  </div>
                </mat-expansion-panel>
              }
            </mat-accordion>
          </div>
        }

        <!-- Course Includes -->
        @if (course()!.courseIncludes && course()!.courseIncludes.length > 0) {
          <div class="course-includes">
            <h2>This course includes:</h2>
            <div class="includes-grid">
              @for (include of course()!.courseIncludes; track include.text) {
                <div class="include-item">
                  <mat-icon>{{ include.icon }}</mat-icon>
                  <span>{{ include.text }}</span>
                </div>
              }
            </div>
          </div>
        }

        <!-- Related Topics -->
        @if (course()!.relatedTopics && course()!.relatedTopics.length > 0) {
          <div class="related-topics">
            <h2>Explore related topics</h2>
            <div class="topics-chips">
              @for (topic of course()!.relatedTopics; track topic) {
                <mat-chip class="topic-chip">{{ topic }}</mat-chip>
              }
            </div>
          </div>
        }
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <div class="video-preview">
          <div class="video-container">
            <img
              [src]="course()!.imageUrl"
              [alt]="course()!.title"
              width="480"
              height="270"
              class="video-thumbnail"
            />
            <div class="play-button">
              <mat-icon>play_circle_filled</mat-icon>
            </div>
          </div>
          <p class="preview-text">Preview this course</p>
        </div>

        <div class="purchase-section">
          <div class="price-display">
            <span class="current-price">₺{{ course()!.price | number: '1.2-2' }}</span>
          </div>

          <div class="purchase-buttons">
            <button mat-raised-button color="primary" class="enroll-button">Enroll Now</button>
          </div>

          <div class="course-info">
            <div class="info-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ course()!.duration }} total length</span>
            </div>
            <div class="info-item">
              <mat-icon>language</mat-icon>
              <span>{{ course()!.language }}</span>
            </div>
            <div class="info-item">
              <mat-icon>workspace_premium</mat-icon>
              <span>Certificate of completion</span>
            </div>
            <div class="info-item">
              <mat-icon>all_inclusive</mat-icon>
              <span>Lifetime access</span>
            </div>
          </div>

          <div class="guarantees">
            <div class="guarantee-item">
              <mat-icon>verified</mat-icon>
              <span>30-Day Money-Back Guarantee</span>
            </div>
            <div class="guarantee-item">
              <mat-icon>schedule</mat-icon>
              <span>Lifetime Access</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="error-container">
      <mat-icon>error</mat-icon>
      <h2>Course not found</h2>
      <p>The course you're looking for doesn't exist or has been removed.</p>
      <button mat-raised-button color="primary" (click)="goBack()">Go Back</button>
    </div>
  }
</div>
